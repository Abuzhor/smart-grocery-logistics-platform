# Planning Scripts

This directory contains automation scripts for bootstrapping and managing GitHub project artifacts.

## Overview

These scripts transform the Notion export documentation (`docs/notion-export/**`) into actionable GitHub issues, labels, milestones, and a Projects v2 board.

## Scripts

### generate_issues_json.py

Python script that parses the execution plan and generates a machine-readable `issues.json` file containing all 40 issue definitions.

**Prerequisites:**
- Python 3.7+

**Usage:**
```bash
python3 scripts/planning/generate_issues_json.py
```

**Output:**
- Creates `scripts/planning/issues.json` with all 40 issue definitions
- Each issue includes: title, body, labels, milestone, and project metadata

### bootstrap_github.sh

Bash script that creates GitHub labels and milestones using the GitHub CLI (`gh`).

**Prerequisites:**
- GitHub CLI (`gh`) installed: https://cli.github.com/
- Authenticated with GitHub: `gh auth login`
- `GH_TOKEN` environment variable set (or authenticated via `gh auth login`)

**Usage:**
```bash
export GH_TOKEN=<your-github-token>
export GITHUB_REPOSITORY=Abuzhor/smart-grocery-logistics-platform

./scripts/planning/bootstrap_github.sh
```

**Features:**
- ✓ Idempotent - safe to re-run multiple times
- ✓ Creates 31 labels across 6 categories
- ✓ Creates/updates 5 milestones with correct due dates (from config.json)
- ✓ Milestone due dates calculated as UTC date + due_days from today
- ✓ Prints summary with GitHub URLs

**What it creates:**

1. **Labels** (6 categories):
   - Phase labels: `phase:0-bootstrap`, `phase:1-foundation`, etc.
   - Domain labels: `domain:catalog`, `domain:inventory`, etc.
   - Type labels: `type:documentation`, `type:feature`, etc.
   - Priority labels: `priority:critical`, `priority:high`, etc.
   - Category labels: `category:grocery`, `category:cold-chain`, etc.
   - Gate labels: `gate:reliability`, `gate:economics`, etc.

2. **Milestones** (5 phases, loaded from config.json):
   - PHASE 0: Bootstrap & Planning (due_on = today + 30 days)
   - PHASE 1: Foundation (due_on = today + 90 days)
   - PHASE 2: MVP Launch (due_on = today + 180 days)
   - PHASE 3: Scale & Optimize (due_on = today + 270 days)
   - PHASE 4: Global Expansion (due_on = today + 365 days)

### bootstrap_github.py

Python script that creates/updates all 40 issues, creates a GitHub Projects v2 board, and populates all custom fields using the GraphQL and REST APIs.

**Prerequisites:**
- Python 3.7+
- `requests` library: `pip install requests`
- `GH_TOKEN` environment variable set
- `issues.json` file (generated by `generate_issues_json.py`)

**Usage:**
```bash
export GH_TOKEN=<your-github-token>

# Install dependencies
pip install requests

# Run script
python3 scripts/planning/bootstrap_github.py
```

**Features:**
- ✓ **Idempotent issue upsert**: Creates new issues or updates existing ones (matches by exact title)
- ✓ Creates/updates all 40 issues from `issues.json`
- ✓ Authoritative label sync (removes labels not in the intended set)
- ✓ **Supports both User and Organization owners** (auto-detects)
- ✓ Creates Projects v2 board with custom fields
- ✓ Adds all 40 issues to the project
- ✓ Sets Phase, Domain, Priority, and Notion Reference fields for each issue
- ✓ Handles pagination and rate limits
- ✓ Prints detailed summary (created, updated, skipped counts)

**What it creates:**

1. **Issues** (40 total, all phases):
   - PHASE 0: 10 issues (bootstrap and planning)
   - PHASE 1: 10 issues (foundation)
   - PHASE 2: 9 issues (MVP launch)
   - PHASE 3: 5 issues (scale and optimize)
   - PHASE 4: 6 issues (global expansion)

2. **Project Board**: "Smart Grocery Logistics Platform - Execution Board"

3. **Custom Fields** (with values set for all issues):
   - Phase (Single select): PHASE 0, PHASE 1, PHASE 2, PHASE 3, PHASE 4
   - Domain (Single select): Catalog, Inventory, Ordering, Fulfillment, etc.
   - Priority (Single select): Critical, High, Medium, Low
   - Notion Reference (Text): Links to source documentation in `docs/notion-export/`

**Idempotency:**
- First run: Creates all 40 issues
- Second run: Updates only if content has changed (body, labels, milestone)
- Shows detailed output: created, updated, and skipped counts

## Execution Order

Run the scripts in this order:

```bash
# 1. Generate issues.json from execution plan
python3 scripts/planning/generate_issues_json.py

# 2. Create labels and milestones
./scripts/planning/bootstrap_github.sh

# 3. Create/update all 40 issues, create Projects v2 board, and populate fields
python3 scripts/planning/bootstrap_github.py
```

**Complete Bootstrap (from scratch):**
```bash
# Set your GitHub token
export GH_TOKEN=<your-github-token>
export GITHUB_REPOSITORY=Abuzhor/smart-grocery-logistics-platform

# Install Python dependencies
pip install requests

# Run the full bootstrap
python3 scripts/planning/generate_issues_json.py
./scripts/planning/bootstrap_github.sh
python3 scripts/planning/bootstrap_github.py
```

## Configuration

Configuration is centralized in two files:

1. **config.json** - Labels and milestones configuration
2. **issues.json** - All 40 issue definitions (generated from execution plan)

Source of truth:
- `docs/planning/PHASE-0-notion-to-github-execution-plan.md`

To modify issues:
1. Update the execution plan document
2. Re-run `generate_issues_json.py` to regenerate `issues.json`
3. Re-run `bootstrap_github.py` to update issues (idempotent)

## Troubleshooting

### GitHub CLI Authentication

If you get authentication errors:
```bash
gh auth login
gh auth status
```

### Python Dependencies

If you get import errors:
```bash
pip install requests
```

### Missing issues.json

If `bootstrap_github.py` fails with "issues.json not found":
```bash
python3 scripts/planning/generate_issues_json.py
```

### GraphQL API Errors

If Projects v2 creation fails:
- Ensure you have the correct permissions (owner or admin)
- Check that the repository exists
- Verify the `GH_TOKEN` has `project` scope
- For personal repos (user), the token must have `project`, `repo` scopes
- For org repos, the token must have `project`, `repo`, `read:org` scopes
- The script now auto-detects whether the owner is a User or Organization

### Rate Limiting

If you hit rate limits:
- Wait a few minutes between runs
- The scripts include rate limit courtesy delays
- The scripts are idempotent, so you can safely re-run them

## Maintenance

### Adding New Issues

1. Add issue definition to execution plan document
2. Run `generate_issues_json.py` to regenerate `issues.json`
3. Run `bootstrap_github.py` to create the new issue and add it to the project

### Updating Existing Issues

1. Update issue definition in execution plan document
2. Run `generate_issues_json.py` to regenerate `issues.json`
3. Run `bootstrap_github.py` - it will update the issue (matches by exact title)

### Updating Labels or Milestones

1. Update `config.json` with new definitions
2. Update execution plan document to match
3. Re-run `bootstrap_github.sh` (idempotent - updates existing labels/milestones)

### Regenerating Everything

The scripts are fully idempotent:
```bash
# Safe to run multiple times - no duplicates created
python3 scripts/planning/generate_issues_json.py
./scripts/planning/bootstrap_github.sh
python3 scripts/planning/bootstrap_github.py
```

## Validation

After running the bootstrap:

1. **Verify Labels**: https://github.com/Abuzhor/smart-grocery-logistics-platform/labels
   - Should have 31 labels across 6 categories

2. **Verify Milestones**: https://github.com/Abuzhor/smart-grocery-logistics-platform/milestones
   - Should have 5 milestones (PHASE 0-4)

3. **Verify Issues**: https://github.com/Abuzhor/smart-grocery-logistics-platform/issues
   - Should have 40 issues total
   - Each issue should have correct labels, milestone, and full body content

4. **Verify Project Board**: Check the project URL from script output
   - All 40 issues should be added
   - Custom fields (Phase, Domain, Priority, Notion Reference) should be populated

## Support

For issues or questions:
1. Check the execution plan: `docs/planning/PHASE-0-notion-to-github-execution-plan.md`
2. Review script output for error messages
3. Check validation checklist: `docs/planning/validation-checklist.md`
4. Open a GitHub issue with the `phase:0-bootstrap` label

## References

- [Execution Plan](../../docs/planning/PHASE-0-notion-to-github-execution-plan.md)
- [Validation Checklist](../../docs/planning/validation-checklist.md)
- [Notion Export](../../docs/notion-export/)
- [GitHub CLI Documentation](https://cli.github.com/manual/)
- [GitHub GraphQL API](https://docs.github.com/en/graphql)
- [GitHub Projects v2](https://docs.github.com/en/issues/planning-and-tracking-with-projects)
